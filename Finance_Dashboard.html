<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Hub — Live Market Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'display': ['Outfit', 'sans-serif'],
                        'mono': ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        'surface': {
                            900: '#0a0a0f',
                            800: '#12121a',
                            700: '#1a1a24',
                            600: '#24242f',
                        },
                        'accent': {
                            cyan: '#06b6d4',
                            emerald: '#10b981',
                            rose: '#f43f5e',
                            amber: '#f59e0b',
                            violet: '#8b5cf6',
                            lime: '#84cc16',
                            sky: '#0ea5e9',
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'shimmer': 'shimmer 2s infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        shimmer: {
                            '0%': { backgroundPosition: '-200% 0' },
                            '100%': { backgroundPosition: '200% 0' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 20px rgba(6, 182, 212, 0.1)' },
                            '100%': { boxShadow: '0 0 40px rgba(6, 182, 212, 0.2)' },
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        * {
            font-family: 'Outfit', sans-serif;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
        }
        
        body {
            background: #0a0a0f;
            background-image: 
                radial-gradient(ellipse 80% 50% at 50% -20%, rgba(6, 182, 212, 0.08), transparent),
                radial-gradient(ellipse 60% 40% at 80% 100%, rgba(139, 92, 246, 0.05), transparent);
            min-height: 100vh;
        }
        
        .glass-card {
            background: linear-gradient(135deg, rgba(26, 26, 36, 0.8) 0%, rgba(18, 18, 26, 0.9) 100%);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: 
                0 4px 24px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .glass-card:hover {
            border-color: rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.08);
        }
        
        .price-up {
            color: #10b981;
            text-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }
        
        .price-down {
            color: #f43f5e;
            text-shadow: 0 0 20px rgba(244, 63, 94, 0.3);
        }
        
        .loading-skeleton {
            background: linear-gradient(90deg, #1a1a24 25%, #24242f 50%, #1a1a24 75%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        .section-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1) 50%, transparent);
        }
        
        .countdown-ring {
            stroke-dasharray: 100;
            stroke-dashoffset: 0;
            transition: stroke-dashoffset 1s linear;
        }
        
        .asset-icon {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
        }
        
        .refresh-btn {
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            transform: rotate(180deg);
        }
        
        .refresh-btn:active {
            transform: rotate(360deg) scale(0.9);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .stagger-1 { animation-delay: 0.05s; }
        .stagger-2 { animation-delay: 0.1s; }
        .stagger-3 { animation-delay: 0.15s; }
        .stagger-4 { animation-delay: 0.2s; }
        .stagger-5 { animation-delay: 0.25s; }
        .stagger-6 { animation-delay: 0.3s; }
        
        /* Currency Toggle Switch */
        .currency-toggle {
            position: relative;
            width: 100px;
            height: 36px;
            background: #1a1a24;
            border-radius: 18px;
            border: 1px solid rgba(255,255,255,0.1);
            cursor: pointer;
            overflow: hidden;
        }
        
        .currency-toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 46px;
            height: 28px;
            background: linear-gradient(135deg, #06b6d4, #8b5cf6);
            border-radius: 14px;
            transition: transform 0.3s ease;
        }
        
        .currency-toggle.eur .currency-toggle-slider {
            transform: translateX(46px);
        }
        
        .currency-toggle-labels {
            position: relative;
            display: flex;
            height: 100%;
            z-index: 1;
        }
        
        .currency-toggle-label {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 600;
            transition: color 0.3s ease;
        }
        
        .currency-toggle .currency-toggle-label.usd {
            color: white;
        }
        
        .currency-toggle .currency-toggle-label.eur {
            color: #6b7280;
        }
        
        .currency-toggle.eur .currency-toggle-label.usd {
            color: #6b7280;
        }
        
        .currency-toggle.eur .currency-toggle-label.eur {
            color: white;
        }
        
        /* Forex card special styling */
        .forex-card .price-display {
            font-size: 1.5rem;
        }
        
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #12121a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #24242f;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #2f2f3a;
        }
    </style>
</head>
<body class="text-white antialiased">
    
    <!-- Header -->
    <header class="sticky top-0 z-50 border-b border-white/5 bg-surface-900/80 backdrop-blur-xl">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo & Title -->
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-accent-cyan to-accent-violet flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-semibold tracking-tight">Finance Hub</h1>
                        <p class="text-xs text-gray-500">Live Market Data</p>
                    </div>
                </div>
                
                <!-- Controls -->
                <div class="flex items-center gap-3 sm:gap-4">
                    <!-- Currency Toggle -->
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-gray-500 hidden sm:inline">Währung:</span>
                        <div id="currencyToggle" class="currency-toggle" title="Währung wechseln">
                            <div class="currency-toggle-slider"></div>
                            <div class="currency-toggle-labels">
                                <span class="currency-toggle-label usd">USD</span>
                                <span class="currency-toggle-label eur">EUR</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Exchange Rate Display -->
                    <div class="hidden md:flex items-center gap-2 text-xs text-gray-400 bg-surface-700 px-3 py-1.5 rounded-lg">
                        <span>1 USD =</span>
                        <span id="exchangeRateDisplay" class="font-mono text-accent-cyan">—</span>
                        <span>EUR</span>
                    </div>
                    
                    <!-- Last Update -->
                    <div class="hidden sm:flex items-center gap-2 text-sm text-gray-400">
                        <span class="w-2 h-2 rounded-full bg-accent-emerald animate-pulse"></span>
                        <span id="lastUpdate">—</span>
                    </div>
                    
                    <!-- Countdown -->
                    <div class="relative w-9 h-9 flex items-center justify-center">
                        <svg class="absolute w-9 h-9 -rotate-90">
                            <circle cx="18" cy="18" r="15" fill="none" stroke="#24242f" stroke-width="2"/>
                            <circle id="countdownRing" cx="18" cy="18" r="15" fill="none" stroke="#06b6d4" stroke-width="2" class="countdown-ring"/>
                        </svg>
                        <span id="countdownText" class="text-xs font-mono text-gray-400">60</span>
                    </div>
                    
                    <!-- Refresh Button -->
                    <button id="refreshBtn" class="refresh-btn w-10 h-10 rounded-xl bg-surface-700 hover:bg-surface-600 flex items-center justify-center transition-all duration-300 border border-white/5">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Market Summary Bar -->
        <div id="marketSummary" class="glass-card rounded-2xl p-4 mb-8">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center gap-4 sm:gap-6">
                    <div class="text-center">
                        <p class="text-xs text-gray-500 uppercase tracking-wider mb-1">Markt</p>
                        <p id="marketStatus" class="text-sm font-medium text-accent-emerald">● Offen</p>
                    </div>
                    <div class="w-px h-8 bg-white/10"></div>
                    <div class="text-center">
                        <p class="text-xs text-gray-500 uppercase tracking-wider mb-1">Assets</p>
                        <p id="totalAssets" class="text-sm font-mono font-medium">—</p>
                    </div>
                    <div class="w-px h-8 bg-white/10 hidden sm:block"></div>
                    <div class="text-center hidden sm:block">
                        <p class="text-xs text-gray-500 uppercase tracking-wider mb-1">Trend</p>
                        <p id="marketTrend" class="text-sm font-medium">—</p>
                    </div>
                    <div class="w-px h-8 bg-white/10 hidden md:block"></div>
                    <div class="text-center hidden md:block">
                        <p class="text-xs text-gray-500 uppercase tracking-wider mb-1">Anzeige</p>
                        <p id="currencyDisplay" class="text-sm font-mono font-medium text-accent-cyan">USD</p>
                    </div>
                </div>
                <div class="flex items-center gap-2 text-xs text-gray-500">
                    <span>API Status:</span>
                    <span id="apiStatus" class="flex items-center gap-1">
                        <span class="w-1.5 h-1.5 rounded-full bg-accent-emerald"></span>
                        Verbunden
                    </span>
                </div>
            </div>
        </div>
        
        <!-- Forex / Currencies Section -->
        <section class="mb-10">
            <div class="flex items-center gap-3 mb-5">
                <div class="w-8 h-8 rounded-lg bg-accent-sky/20 flex items-center justify-center">
                    <svg class="w-4 h-4 text-accent-sky" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold">Währungen</h2>
                <span class="text-xs text-gray-500 bg-surface-700 px-2 py-1 rounded-full">Live via Frankfurter API</span>
            </div>
            <div id="forexGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- Forex cards will be inserted here -->
            </div>
        </section>
        
        <div class="section-divider mb-10"></div>
        
        <!-- Crypto Section -->
        <section class="mb-10">
            <div class="flex items-center gap-3 mb-5">
                <div class="w-8 h-8 rounded-lg bg-accent-amber/20 flex items-center justify-center">
                    <svg class="w-4 h-4 text-accent-amber" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M11.944 17.97L4.58 13.62 11.943 24l7.37-10.38-7.372 4.35h.003zM12.056 0L4.69 12.223l7.365 4.354 7.365-4.35L12.056 0z"/>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold">Kryptowährungen</h2>
                <span class="text-xs text-gray-500 bg-surface-700 px-2 py-1 rounded-full">Live via CoinGecko</span>
            </div>
            <div id="cryptoGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Crypto cards will be inserted here -->
            </div>
        </section>
        
        <div class="section-divider mb-10"></div>
        
        <!-- Stocks Section -->
        <section class="mb-10">
            <div class="flex items-center gap-3 mb-5">
                <div class="w-8 h-8 rounded-lg bg-accent-cyan/20 flex items-center justify-center">
                    <svg class="w-4 h-4 text-accent-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold">Aktien</h2>
                <span class="text-xs text-gray-500 bg-surface-700 px-2 py-1 rounded-full">Live via Finnhub</span>
            </div>
            <div id="stocksGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Stock cards will be inserted here -->
            </div>
        </section>
        
        <div class="section-divider mb-10"></div>
        
        <!-- Commodities Section (Metals) -->
        <section class="mb-10">
            <div class="flex items-center gap-3 mb-5">
                <div class="w-8 h-8 rounded-lg bg-accent-violet/20 flex items-center justify-center">
                    <svg class="w-4 h-4 text-accent-violet" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold">Edelmetalle</h2>
                <span class="text-xs text-gray-500 bg-surface-700 px-2 py-1 rounded-full">Live via Metals.dev</span>
            </div>
            <div id="metalsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Metal cards will be inserted here -->
            </div>
        </section>
        
        <div class="section-divider mb-10"></div>
        
        <!-- Soft Commodities Section (Agricultural) -->
        <section class="mb-10">
            <div class="flex items-center gap-3 mb-5">
                <div class="w-8 h-8 rounded-lg bg-accent-lime/20 flex items-center justify-center">
                    <svg class="w-4 h-4 text-accent-lime" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h2 class="text-xl font-semibold">Agrarrohstoffe</h2>
                <span class="text-xs text-gray-500 bg-surface-700 px-2 py-1 rounded-full">Soft Commodities</span>
            </div>
            <div id="softCommoditiesGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Soft commodity cards will be inserted here -->
            </div>
        </section>
        
    </main>
    
    <!-- Footer -->
    <footer class="border-t border-white/5 py-6 mt-auto">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4 text-sm text-gray-500">
                <p>Datenquellen: CoinGecko, Finnhub, Frankfurter API</p>
                <p>Kurse dienen nur zur Information — keine Anlageberatung</p>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript -->
    <script>
        // ============================================
        // CONFIGURATION
        // ============================================
        
        const CONFIG = {
            refreshInterval: 60, // seconds
            finnhubApiKey: 'd5hrep9r01qu7bqpjh6gd5hrep9r01qu7bqpjh70',
            metalsApiKey: 'MEGBXGKSGAUU5GGYWK4V400GYWK4V',
            
            // Currency settings
            baseCurrency: 'USD',
            targetCurrency: 'EUR',
            
            forex: [
                { base: 'EUR', target: 'USD', name: 'Euro / US-Dollar', color: '#0052b4' },
                { base: 'GBP', target: 'USD', name: 'Pfund / US-Dollar', color: '#c8102e' },
                { base: 'JPY', target: 'USD', name: 'Yen / US-Dollar', color: '#bc002d', inverse: true },
                { base: 'CHF', target: 'USD', name: 'Franken / US-Dollar', color: '#d52b1e' },
                { base: 'CNY', target: 'USD', name: 'Yuan / US-Dollar', color: '#de2910', inverse: true },
                { base: 'AUD', target: 'USD', name: 'AUD / US-Dollar', color: '#00008b' },
                { base: 'CAD', target: 'USD', name: 'CAD / US-Dollar', color: '#ff0000' },
                { base: 'BTC', target: 'USD', name: 'Bitcoin / US-Dollar', color: '#f7931a', crypto: true },
            ],
            
            crypto: [
                { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin', color: '#f7931a' },
                { id: 'ethereum', symbol: 'ETH', name: 'Ethereum', color: '#627eea' },
                { id: 'solana', symbol: 'SOL', name: 'Solana', color: '#00ffa3' },
                { id: 'cardano', symbol: 'ADA', name: 'Cardano', color: '#0033ad' },
                { id: 'ripple', symbol: 'XRP', name: 'Ripple', color: '#00aae4' },
                { id: 'polkadot', symbol: 'DOT', name: 'Polkadot', color: '#e6007a' },
            ],
            
            stocks: [
                { symbol: 'AAPL', name: 'Apple', color: '#a2aaad' },
                { symbol: 'MSFT', name: 'Microsoft', color: '#00a4ef' },
                { symbol: 'NVDA', name: 'NVIDIA', color: '#76b900' },
                { symbol: 'GOOGL', name: 'Alphabet', color: '#4285f4' },
                { symbol: 'AMZN', name: 'Amazon', color: '#ff9900' },
                { symbol: 'TSLA', name: 'Tesla', color: '#cc0000' },
            ],
            
            metals: [
                { symbol: 'XAU', name: 'Gold', unit: 'oz', color: '#ffd700' },
                { symbol: 'XAG', name: 'Silber', unit: 'oz', color: '#c0c0c0' },
                { symbol: 'XPT', name: 'Platin', unit: 'oz', color: '#e5e4e2' },
            ],
            
            softCommodities: [
                { symbol: 'COCOA', name: 'Kakao', unit: 'MT', color: '#5c3317' },
                { symbol: 'COFFEE', name: 'Kaffee', unit: 'lb', color: '#6f4e37' },
                { symbol: 'SUGAR', name: 'Zucker', unit: 'lb', color: '#f5f5dc' },
                { symbol: 'WHEAT', name: 'Weizen', unit: 'bu', color: '#f5deb3' },
                { symbol: 'CORN', name: 'Mais', unit: 'bu', color: '#fbec5d' },
                { symbol: 'COTTON', name: 'Baumwolle', unit: 'lb', color: '#fffaf0' },
            ]
        };
        
        // ============================================
        // STATE
        // ============================================
        
        let state = {
            countdown: CONFIG.refreshInterval,
            isLoading: false,
            lastUpdate: null,
            currency: 'USD', // Current display currency
            exchangeRate: 1, // USD to EUR rate
            errors: { crypto: false, stocks: false, metals: false, softCommodities: false, forex: false },
            data: { crypto: [], stocks: [], metals: [], softCommodities: [], forex: [] }
        };
        
        // ============================================
        // API FUNCTIONS
        // ============================================
        
        // Frankfurter API - Completely free, no key needed
        async function fetchExchangeRate() {
            try {
                const response = await fetch('https://api.frankfurter.app/latest?from=USD&to=EUR');
                if (!response.ok) throw new Error('Exchange rate API error');
                const data = await response.json();
                state.exchangeRate = data.rates.EUR;
                document.getElementById('exchangeRateDisplay').textContent = state.exchangeRate.toFixed(4);
                return state.exchangeRate;
            } catch (error) {
                console.error('Exchange rate fetch error:', error);
                state.exchangeRate = 0.92; // Fallback rate
                document.getElementById('exchangeRateDisplay').textContent = '~0.92';
                return state.exchangeRate;
            }
        }
        
        // Fetch Forex data
        async function fetchForexData() {
            try {
                const response = await fetch('https://api.frankfurter.app/latest?from=USD');
                if (!response.ok) throw new Error('Forex API error');
                const data = await response.json();
                
                state.errors.forex = false;
                
                return CONFIG.forex.map(pair => {
                    if (pair.crypto) {
                        // BTC rate comes from crypto data
                        return {
                            ...pair,
                            rate: 0, // Will be updated from crypto data
                            change24h: 0,
                            loaded: false,
                            isCrypto: true
                        };
                    }
                    
                    let rate;
                    if (pair.base === 'USD') {
                        rate = data.rates[pair.target] || 0;
                    } else if (pair.target === 'USD') {
                        rate = 1 / (data.rates[pair.base] || 1);
                    } else {
                        rate = data.rates[pair.base] || 0;
                    }
                    
                    if (pair.inverse) {
                        rate = 1 / rate;
                    }
                    
                    // Simulate 24h change (Frankfurter doesn't provide this)
                    const change = (Math.random() - 0.5) * 1.5;
                    
                    return {
                        ...pair,
                        rate: rate,
                        change24h: change,
                        loaded: true
                    };
                });
            } catch (error) {
                console.error('Forex fetch error:', error);
                state.errors.forex = true;
                return generateSimulatedForex();
            }
        }
        
        function generateSimulatedForex() {
            const baseRates = {
                'EUR': 1.08, 'GBP': 1.27, 'JPY': 0.0067, 
                'CHF': 1.13, 'CNY': 0.14, 'AUD': 0.65, 'CAD': 0.74
            };
            
            return CONFIG.forex.map(pair => {
                if (pair.crypto) {
                    return { ...pair, rate: 0, change24h: 0, loaded: false, isCrypto: true };
                }
                
                const base = baseRates[pair.base] || 1;
                const variance = (Math.random() - 0.5) * base * 0.01;
                
                return {
                    ...pair,
                    rate: base + variance,
                    change24h: (Math.random() - 0.5) * 1.5,
                    loaded: true,
                    simulated: true
                };
            });
        }
        
        // CoinGecko API - Free, no key required
        async function fetchCryptoData() {
            const ids = CONFIG.crypto.map(c => c.id).join(',');
            const vsCurrency = state.currency.toLowerCase();
            const url = `https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=${vsCurrency}&include_24hr_change=true`;
            
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('CoinGecko API error');
                
                const data = await response.json();
                state.errors.crypto = false;
                
                const cryptoData = CONFIG.crypto.map(crypto => ({
                    ...crypto,
                    price: data[crypto.id]?.[vsCurrency] || 0,
                    change24h: data[crypto.id]?.[`${vsCurrency}_24h_change`] || 0,
                    loaded: true
                }));
                
                // Update BTC/USD forex pair
                const btcPrice = data['bitcoin']?.usd || 0;
                const forexBtc = state.data.forex.find(f => f.crypto);
                if (forexBtc && btcPrice > 0) {
                    forexBtc.rate = btcPrice;
                    forexBtc.change24h = data['bitcoin']?.usd_24h_change || 0;
                    forexBtc.loaded = true;
                }
                
                return cryptoData;
            } catch (error) {
                console.error('Crypto fetch error:', error);
                state.errors.crypto = true;
                return CONFIG.crypto.map(crypto => ({
                    ...crypto,
                    price: 0,
                    change24h: 0,
                    loaded: false,
                    error: true
                }));
            }
        }
        
        // Finnhub API
        async function fetchStockData() {
            const results = [];
            
            for (const stock of CONFIG.stocks) {
                try {
                    const url = `https://finnhub.io/api/v1/quote?symbol=${stock.symbol}&token=${CONFIG.finnhubApiKey}`;
                    const response = await fetch(url);
                    
                    if (!response.ok) throw new Error('Finnhub API error');
                    
                    const data = await response.json();
                    
                    if (data.c && data.c > 0) {
                        let price = data.c;
                        if (state.currency === 'EUR') {
                            price = price * state.exchangeRate;
                        }
                        
                        results.push({
                            ...stock,
                            price: price,
                            priceUSD: data.c,
                            change24h: data.dp || 0,
                            high: data.h,
                            low: data.l,
                            loaded: true
                        });
                    } else {
                        results.push(generateSimulatedStock(stock));
                    }
                } catch (error) {
                    console.error(`Stock fetch error for ${stock.symbol}:`, error);
                    results.push(generateSimulatedStock(stock));
                }
                
                await new Promise(resolve => setTimeout(resolve, 100));
            }
            
            state.errors.stocks = results.every(r => r.simulated);
            return results;
        }
        
        function generateSimulatedStock(stock) {
            // Preise Stand Januar 2025
            const basePrices = {
                'AAPL': 232.50,  // Apple
                'MSFT': 425.80,  // Microsoft
                'NVDA': 138.50,  // NVIDIA (nach 10:1 Split Juni 2024)
                'GOOGL': 193.20, // Alphabet
                'AMZN': 225.40,  // Amazon
                'TSLA': 410.50   // Tesla
            };
            
            const base = basePrices[stock.symbol] || 100;
            const variance = (Math.random() - 0.5) * base * 0.02;
            let price = base + variance;
            
            if (state.currency === 'EUR') {
                price = price * state.exchangeRate;
            }
            
            return {
                ...stock,
                price: price,
                priceUSD: base + variance,
                change24h: (Math.random() - 0.5) * 4,
                loaded: true,
                simulated: true
            };
        }
        
        // Metals data - Live via Metals.dev
        // AUSKOMMENTIERT: Nur 25 Calls/Monat! Für Produktion wieder aktivieren.
        async function fetchMetalsData() {
            /*
            try {
                const response = await fetch(`https://api.metals.dev/v1/latest?api_key=${CONFIG.metalsApiKey}&currency=USD&unit=toz`);
                
                if (response.ok) {
                    const data = await response.json();
                    state.errors.metals = false;
                    
                    return CONFIG.metals.map(metal => {
                        // Metals.dev verwendet lowercase keys: gold, silver, platinum
                        const metalKeys = {
                            'XAU': 'gold',
                            'XAG': 'silver', 
                            'XPT': 'platinum'
                        };
                        const metalKey = metalKeys[metal.symbol];
                        let price = data.metals?.[metalKey] || 0;
                        
                        if (state.currency === 'EUR' && price > 0) {
                            price = price * state.exchangeRate;
                        }
                        
                        return {
                            ...metal,
                            price: price,
                            change24h: (Math.random() - 0.5) * 2, // API liefert keine 24h-Änderung
                            loaded: price > 0
                        };
                    });
                }
                
                throw new Error('Metals API unavailable');
            } catch (error) {
                console.error('Metals fetch error:', error);
                state.errors.metals = true;
                return generateSimulatedMetals();
            }
            */
            // Temporär: Simulierte Daten während Entwicklung
            return generateSimulatedMetals();
        }
        
        function generateSimulatedMetals() {
            const basePrices = {
                'XAU': 2650.00,  // Gold - aktuell ~$2.600-2.700
                'XAG': 31.50,    // Silber - aktuell ~$30-32
                'XPT': 980.00,   // Platin - aktuell ~$950-1.000
            };
            
            return CONFIG.metals.map(metal => {
                const base = basePrices[metal.symbol] || 100;
                const variance = (Math.random() - 0.5) * base * 0.01;
                let price = base + variance;
                
                if (state.currency === 'EUR') {
                    price = price * state.exchangeRate;
                }
                
                return {
                    ...metal,
                    price: price,
                    change24h: (Math.random() - 0.5) * 1.5,
                    loaded: true,
                    simulated: true
                };
            });
        }
        
        // Soft Commodities (simulated - most free APIs don't cover these)
        async function fetchSoftCommoditiesData() {
            // These typically require premium APIs, so we simulate realistic values
            // Preise Stand Januar 2025
            const basePrices = {
                'COCOA': 9500.00,   // USD per metric ton - 2024 massiv gestiegen
                'COFFEE': 3.25,     // USD per lb - Arabica Futures
                'SUGAR': 0.21,      // USD per lb
                'WHEAT': 5.45,      // USD per bushel
                'CORN': 4.35,       // USD per bushel
                'COTTON': 0.72,     // USD per lb
            };
            
            return CONFIG.softCommodities.map(commodity => {
                const base = basePrices[commodity.symbol] || 100;
                const variance = (Math.random() - 0.5) * base * 0.03;
                let price = base + variance;
                
                if (state.currency === 'EUR') {
                    price = price * state.exchangeRate;
                }
                
                return {
                    ...commodity,
                    price: price,
                    change24h: (Math.random() - 0.5) * 3,
                    loaded: true,
                    simulated: true
                };
            });
        }
        
        // ============================================
        // RENDER FUNCTIONS
        // ============================================
        
        function getCurrencySymbol() {
            return state.currency === 'EUR' ? '€' : '$';
        }
        
        function createAssetCard(asset, type, index) {
            const isPositive = asset.change24h >= 0;
            const changeClass = isPositive ? 'price-up' : 'price-down';
            const arrow = isPositive ? '↑' : '↓';
            const changeFormatted = `${isPositive ? '+' : ''}${asset.change24h.toFixed(2)}%`;
            const currencySymbol = getCurrencySymbol();
            
            let priceFormatted;
            if (type === 'crypto') {
                priceFormatted = asset.price.toLocaleString('de-DE', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: asset.price < 1 ? 4 : 2 
                });
            } else if (type === 'softCommodities' && asset.symbol === 'COCOA') {
                priceFormatted = asset.price.toLocaleString('de-DE', { 
                    minimumFractionDigits: 0, 
                    maximumFractionDigits: 0 
                });
            } else {
                priceFormatted = asset.price.toLocaleString('de-DE', { 
                    minimumFractionDigits: 2, 
                    maximumFractionDigits: 2 
                });
            }
            
            const unit = asset.unit ? `/${asset.unit}` : '';
            
            const statusBadge = asset.simulated 
                ? '<span class="text-[10px] text-amber-500/70 bg-amber-500/10 px-1.5 py-0.5 rounded">Demo</span>' 
                : asset.error 
                    ? '<span class="text-[10px] text-rose-500/70 bg-rose-500/10 px-1.5 py-0.5 rounded">Offline</span>'
                    : '';
            
            return `
                <div class="glass-card rounded-2xl p-5 transition-all duration-300 hover:scale-[1.02] opacity-0 fade-in stagger-${(index % 6) + 1}" style="animation-fill-mode: forwards;">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center gap-3">
                            <div class="asset-icon" style="background: ${asset.color}20; color: ${asset.color};">
                                ${asset.symbol.substring(0, 3)}
                            </div>
                            <div>
                                <h3 class="font-semibold text-white">${asset.name}</h3>
                                <p class="text-xs text-gray-500">${asset.symbol}</p>
                            </div>
                        </div>
                        ${statusBadge}
                    </div>
                    
                    <div class="flex items-end justify-between">
                        <div>
                            <p class="text-2xl font-mono font-semibold text-white tracking-tight">
                                ${currencySymbol}${priceFormatted}
                            </p>
                            <p class="text-xs text-gray-500 mt-1">${unit ? `pro ${asset.unit}` : state.currency}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-mono text-sm font-medium ${changeClass}">
                                ${arrow} ${changeFormatted}
                            </p>
                            <p class="text-xs text-gray-500">24h</p>
                        </div>
                    </div>
                    
                    <!-- Mini Chart -->
                    <div class="mt-4 h-10 rounded-lg overflow-hidden bg-surface-800/50">
                        <svg class="w-full h-full" preserveAspectRatio="none">
                            <defs>
                                <linearGradient id="chartGradient${type}${index}" x1="0" y1="0" x2="0" y2="1">
                                    <stop offset="0%" stop-color="${isPositive ? '#10b981' : '#f43f5e'}" stop-opacity="0.3"/>
                                    <stop offset="100%" stop-color="${isPositive ? '#10b981' : '#f43f5e'}" stop-opacity="0"/>
                                </linearGradient>
                            </defs>
                            <path d="${generateMiniChartPath(isPositive)}" fill="url(#chartGradient${type}${index})" />
                            <path d="${generateMiniChartLine(isPositive)}" fill="none" stroke="${isPositive ? '#10b981' : '#f43f5e'}" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                    </div>
                </div>
            `;
        }
        
        function createForexCard(pair, index) {
            if (pair.isCrypto && !pair.loaded) {
                return ''; // Don't show BTC pair if not loaded yet
            }
            
            const isPositive = pair.change24h >= 0;
            const changeClass = isPositive ? 'price-up' : 'price-down';
            const arrow = isPositive ? '↑' : '↓';
            const changeFormatted = `${isPositive ? '+' : ''}${pair.change24h.toFixed(2)}%`;
            
            let rateFormatted;
            if (pair.isCrypto) {
                rateFormatted = pair.rate.toLocaleString('de-DE', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
            } else if (pair.inverse) {
                rateFormatted = pair.rate.toLocaleString('de-DE', { minimumFractionDigits: 4, maximumFractionDigits: 4 });
            } else {
                rateFormatted = pair.rate.toLocaleString('de-DE', { minimumFractionDigits: 4, maximumFractionDigits: 4 });
            }
            
            const statusBadge = pair.simulated 
                ? '<span class="text-[10px] text-amber-500/70 bg-amber-500/10 px-1.5 py-0.5 rounded">Demo</span>' 
                : '';
            
            return `
                <div class="glass-card forex-card rounded-2xl p-4 transition-all duration-300 hover:scale-[1.02] opacity-0 fade-in stagger-${(index % 6) + 1}" style="animation-fill-mode: forwards;">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-lg flex items-center justify-center text-xs font-bold" style="background: ${pair.color}20; color: ${pair.color};">
                                ${pair.base}
                            </div>
                            <div>
                                <p class="text-sm font-medium text-white">${pair.base}/${pair.target}</p>
                                <p class="text-[10px] text-gray-500">${pair.name}</p>
                            </div>
                        </div>
                        ${statusBadge}
                    </div>
                    
                    <div class="flex items-end justify-between">
                        <p class="price-display font-mono font-semibold text-white">
                            ${pair.isCrypto ? '$' : ''}${rateFormatted}
                        </p>
                        <p class="font-mono text-xs font-medium ${changeClass}">
                            ${arrow} ${changeFormatted}
                        </p>
                    </div>
                </div>
            `;
        }
        
        function generateMiniChartPath(isPositive) {
            const points = generateChartPoints(isPositive);
            let path = `M 0 40 L 0 ${points[0]}`;
            points.forEach((y, i) => {
                const x = (i / (points.length - 1)) * 100;
                path += ` L ${x} ${y}`;
            });
            path += ' L 100 40 Z';
            return path;
        }
        
        function generateMiniChartLine(isPositive) {
            const points = generateChartPoints(isPositive);
            let path = `M 0 ${points[0]}`;
            points.forEach((y, i) => {
                if (i === 0) return;
                const x = (i / (points.length - 1)) * 100;
                path += ` L ${x} ${y}`;
            });
            return path;
        }
        
        function generateChartPoints(isPositive) {
            const trend = isPositive ? -0.5 : 0.5;
            const points = [];
            let y = 20 + Math.random() * 10;
            
            for (let i = 0; i < 20; i++) {
                y += (Math.random() - 0.5 + trend) * 3;
                y = Math.max(5, Math.min(35, y));
                points.push(y);
            }
            
            return points;
        }
        
        function createLoadingCard() {
            return `
                <div class="glass-card rounded-2xl p-5">
                    <div class="flex items-center gap-3 mb-4">
                        <div class="w-10 h-10 rounded-xl loading-skeleton"></div>
                        <div class="flex-1">
                            <div class="h-4 w-20 rounded loading-skeleton mb-2"></div>
                            <div class="h-3 w-12 rounded loading-skeleton"></div>
                        </div>
                    </div>
                    <div class="h-8 w-32 rounded loading-skeleton mb-2"></div>
                    <div class="h-4 w-16 rounded loading-skeleton"></div>
                </div>
            `;
        }
        
        function createLoadingCardSmall() {
            return `
                <div class="glass-card rounded-2xl p-4">
                    <div class="flex items-center gap-2 mb-3">
                        <div class="w-8 h-8 rounded-lg loading-skeleton"></div>
                        <div class="flex-1">
                            <div class="h-3 w-16 rounded loading-skeleton mb-1"></div>
                            <div class="h-2 w-20 rounded loading-skeleton"></div>
                        </div>
                    </div>
                    <div class="h-6 w-24 rounded loading-skeleton"></div>
                </div>
            `;
        }
        
        function renderSection(containerId, data, type, isForex = false) {
            const container = document.getElementById(containerId);
            
            if (state.isLoading && data.length === 0) {
                const loadingCard = isForex ? createLoadingCardSmall() : createLoadingCard();
                const count = isForex ? 4 : 3;
                container.innerHTML = Array(count).fill(loadingCard).join('');
                return;
            }
            
            if (isForex) {
                container.innerHTML = data.map((pair, index) => createForexCard(pair, index)).join('');
            } else {
                container.innerHTML = data.map((asset, index) => createAssetCard(asset, type, index)).join('');
            }
        }
        
        function updateMarketSummary() {
            const totalAssets = 
                state.data.crypto.length + 
                state.data.stocks.length + 
                state.data.metals.length + 
                state.data.softCommodities.length +
                state.data.forex.filter(f => f.loaded).length;
            
            document.getElementById('totalAssets').textContent = totalAssets;
            document.getElementById('currencyDisplay').textContent = state.currency;
            
            const allChanges = [
                ...state.data.crypto.map(a => a.change24h),
                ...state.data.stocks.map(a => a.change24h),
                ...state.data.metals.map(a => a.change24h),
                ...state.data.softCommodities.map(a => a.change24h)
            ].filter(c => !isNaN(c));
            
            const avgChange = allChanges.reduce((a, b) => a + b, 0) / allChanges.length;
            const trendEl = document.getElementById('marketTrend');
            
            if (avgChange >= 0.5) {
                trendEl.innerHTML = '<span class="price-up">↑ Bullish</span>';
            } else if (avgChange <= -0.5) {
                trendEl.innerHTML = '<span class="price-down">↓ Bearish</span>';
            } else {
                trendEl.innerHTML = '<span class="text-gray-400">→ Neutral</span>';
            }
            
            const hasErrors = Object.values(state.errors).some(e => e);
            const apiStatusEl = document.getElementById('apiStatus');
            
            if (hasErrors) {
                apiStatusEl.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-accent-amber"></span> Teilweise';
            } else {
                apiStatusEl.innerHTML = '<span class="w-1.5 h-1.5 rounded-full bg-accent-emerald"></span> Verbunden';
            }
        }
        
        function updateLastUpdate() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('lastUpdate').textContent = `Update: ${timeStr}`;
            state.lastUpdate = now;
        }
        
        // ============================================
        // CURRENCY TOGGLE
        // ============================================
        
        function toggleCurrency() {
            const toggle = document.getElementById('currencyToggle');
            
            if (state.currency === 'USD') {
                state.currency = 'EUR';
                toggle.classList.add('eur');
            } else {
                state.currency = 'USD';
                toggle.classList.remove('eur');
            }
            
            // Re-render with new currency
            refreshAllData();
        }
        
        // ============================================
        // COUNTDOWN & REFRESH LOGIC
        // ============================================
        
        function updateCountdown() {
            const ring = document.getElementById('countdownRing');
            const text = document.getElementById('countdownText');
            
            const circumference = 2 * Math.PI * 15;
            const offset = circumference * (1 - state.countdown / CONFIG.refreshInterval);
            
            ring.style.strokeDasharray = circumference;
            ring.style.strokeDashoffset = offset;
            text.textContent = state.countdown;
            
            if (state.countdown <= 0) {
                refreshAllData();
                state.countdown = CONFIG.refreshInterval;
            } else {
                state.countdown--;
            }
        }
        
        async function refreshAllData() {
            if (state.isLoading) return;
            
            state.isLoading = true;
            
            // Show loading state
            renderSection('forexGrid', [], 'forex', true);
            renderSection('cryptoGrid', [], 'crypto');
            renderSection('stocksGrid', [], 'stocks');
            renderSection('metalsGrid', [], 'metals');
            renderSection('softCommoditiesGrid', [], 'softCommodities');
            
            try {
                // First fetch exchange rate
                await fetchExchangeRate();
                
                // Then fetch all data in parallel
                const [forexData, cryptoData, stockData, metalsData, softCommoditiesData] = await Promise.all([
                    fetchForexData(),
                    fetchCryptoData(),
                    fetchStockData(),
                    fetchMetalsData(),
                    fetchSoftCommoditiesData()
                ]);
                
                state.data.forex = forexData;
                state.data.crypto = cryptoData;
                state.data.stocks = stockData;
                state.data.metals = metalsData;
                state.data.softCommodities = softCommoditiesData;
                
                // Update BTC in forex from crypto data
                const btcCrypto = cryptoData.find(c => c.symbol === 'BTC');
                const btcForex = forexData.find(f => f.crypto);
                if (btcCrypto && btcForex) {
                    btcForex.rate = btcCrypto.price;
                    btcForex.change24h = btcCrypto.change24h;
                    btcForex.loaded = true;
                }
                
                // Render all sections
                renderSection('forexGrid', forexData, 'forex', true);
                renderSection('cryptoGrid', cryptoData, 'crypto');
                renderSection('stocksGrid', stockData, 'stocks');
                renderSection('metalsGrid', metalsData, 'metals');
                renderSection('softCommoditiesGrid', softCommoditiesData, 'softCommodities');
                
                // Update UI
                updateMarketSummary();
                updateLastUpdate();
                
            } catch (error) {
                console.error('Refresh error:', error);
            } finally {
                state.isLoading = false;
                state.countdown = CONFIG.refreshInterval;
            }
        }
        
        // ============================================
        // EVENT LISTENERS & INITIALIZATION
        // ============================================
        
        document.getElementById('refreshBtn').addEventListener('click', () => {
            state.countdown = 0;
            refreshAllData();
        });
        
        document.getElementById('currencyToggle').addEventListener('click', toggleCurrency);
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            refreshAllData();
            setInterval(updateCountdown, 1000);
        });
    </script>
</body>
</html>